const e={registration:{name:"Registration",description:"Initial candidate registration and data collection",color:"#3B82F6",order:1,requiredFields:["name","phone","email","interestedFor"]},"resume-sharing":{name:"Resume Sharing",description:"Resume shared with potential clients",color:"#8B5CF6",order:2,requiredFields:["resumeSharing.shortlistsForClient"]},shortlisting:{name:"Shortlisting",description:"Candidate shortlisted by client",color:"#F59E0B",order:3,requiredFields:["shortlisting.shortlistDate"]},"lineup-feedback":{name:"Lineup & Feedback",description:"Interview scheduled and feedback collected",color:"#06B6D4",order:4,requiredFields:["lineupFeedback.feedbacks"]},selection:{name:"Selection",description:"Candidate selected by client",color:"#10B981",order:5,requiredFields:["selection.selectionStatus"]},closure:{name:"Closure",description:"Candidate placement completed",color:"#059669",order:6,requiredFields:["closure.joiningStatus"]},completed:{name:"Completed",description:"Full recruitment cycle completed",color:"#047857",order:7,requiredFields:[]}},t={new:{name:"New",color:"#6B7280",description:"Recently added candidate"},"in-process":{name:"In Process",color:"#3B82F6",description:"Actively being processed"},shortlisted:{name:"Shortlisted",color:"#F59E0B",description:"Shortlisted by client"},interviewed:{name:"Interviewed",color:"#06B6D4",description:"Interview completed"},selected:{name:"Selected",color:"#10B981",description:"Selected by client"},placed:{name:"Placed",color:"#059669",description:"Successfully placed"},rejected:{name:"Rejected",color:"#EF4444",description:"Rejected by client"}},a={generateCandidateId:()=>`cand_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,generateCVNumber:(e=[])=>{let t,a=1;do{t=String(a),a++}while(e.includes(t));return t},determineCurrentStage:e=>{var t,a,n,r,i,s,o,l;return"Yes"===(null==(t=e.closure)?void 0:t.joiningStatus)?"completed":(null==(a=e.closure)?void 0:a.joiningDate)||(null==(n=e.closure)?void 0:n.placedIn)?"closure":"Selected"===(null==(r=e.selection)?void 0:r.selectionStatus)?"selection":(null==(s=null==(i=e.lineupFeedback)?void 0:i.feedbacks)?void 0:s.length)&&"Done"===e.lineupFeedback.lineupStatus?"lineup-feedback":"Done"===(null==(o=e.shortlisting)?void 0:o.shortlistStatus)?"shortlisting":"Done"===(null==(l=e.resumeSharing)?void 0:l.resumeShareStatus)?"resume-sharing":"registration"},determineOverallStatus:e=>{var t,n,r;const i=a.determineCurrentStage(e);if("Rejected"===(null==(t=e.selection)?void 0:t.selectionStatus)||(null==(r=null==(n=e.lineupFeedback)?void 0:n.feedbacks)?void 0:r.some(e=>"Rejected"===e.feedback||"Reject"===e.feedback)))return"rejected";switch(i){case"completed":return"placed";case"closure":case"selection":return"selected";case"lineup-feedback":return"interviewed";case"shortlisting":return"shortlisted";case"resume-sharing":return"in-process";default:return"new"}},createNewCandidate:(e,t,n)=>{var r,i,s,o,l,d,c,u,g,h,m,p,S,y,v,f,b,C,N,D,F,$,k,B;const w=new Date,E=a.generateCandidateId(),I={id:E,cvNo:e.cvNo||a.generateCVNumber(),name:e.name||"",phone:e.phone||"",email:e.email||"",location:e.location||"",interestedFor:e.interestedFor||"",declaration:e.declaration,currentCompany:e.currentCompany,industry:e.industry,designation:e.designation||"",totalExperience:e.totalExperience||"",lastSalary:e.lastSalary||"",salaryExpectation:e.salaryExpectation||"",qualification:e.qualification||"",allocation:e.allocation||"",registration:{date:(null==(r=e.registration)?void 0:r.date)||w,resource:(null==(i=e.registration)?void 0:i.resource)||"",registrationStatus:(null==(s=e.registration)?void 0:s.registrationStatus)||"Yes",registrationAmount:null==(o=e.registration)?void 0:o.registrationAmount},resumeSharing:{date:null==(l=e.resumeSharing)?void 0:l.date,shortlistsForClient:null==(d=e.resumeSharing)?void 0:d.shortlistsForClient,resumeShareStatus:(null==(c=e.resumeSharing)?void 0:c.resumeShareStatus)||"Pending",remark:null==(u=e.resumeSharing)?void 0:u.remark},shortlisting:{shortlistDate:null==(g=e.shortlisting)?void 0:g.shortlistDate,shortlistsForClient:null==(h=e.shortlisting)?void 0:h.shortlistsForClient,resource:null==(m=e.shortlisting)?void 0:m.resource,shortlistStatus:(null==(p=e.shortlisting)?void 0:p.shortlistStatus)||"Pending"},lineupFeedback:{shortlistDate:null==(S=e.lineupFeedback)?void 0:S.shortlistDate,shortlistsForClient:null==(y=e.lineupFeedback)?void 0:y.shortlistsForClient,feedbacks:(null==(v=e.lineupFeedback)?void 0:v.feedbacks)||[],lineupStatus:(null==(f=e.lineupFeedback)?void 0:f.lineupStatus)||"Pending"},selection:{client:null==(b=e.selection)?void 0:b.client,selectionDate:null==(C=e.selection)?void 0:C.selectionDate,selectionStatus:null==(N=e.selection)?void 0:N.selectionStatus},closure:{joiningDate:null==(D=e.closure)?void 0:D.joiningDate,placedIn:null==(F=e.closure)?void 0:F.placedIn,offeredSalary:null==($=e.closure)?void 0:$.offeredSalary,charges:null==(k=e.closure)?void 0:k.charges,joiningStatus:null==(B=e.closure)?void 0:B.joiningStatus},avatar:e.avatar,rating:e.rating,tags:e.tags||[],notes:e.notes||[],createdBy:t,createdByName:n,lastModifiedBy:t,lastModifiedByName:n,changeHistory:[a.createChangeHistoryEntry(E,t,n,"created",[],"Candidate created")],createdAt:w,updatedAt:w,currentStage:"registration",overallStatus:"new"};return I.currentStage=a.determineCurrentStage(I),I.overallStatus=a.determineOverallStatus(I),I},updateCandidateStage:(e,t)=>{const n={...e,...t,updatedAt:new Date};return n.currentStage=a.determineCurrentStage(n),n.overallStatus=a.determineOverallStatus(n),n},getStageConfig:t=>e[t],getStatusConfig:e=>t[e],getNextStages:t=>{const a=Object.values(e).sort((e,t)=>e.order-t.order),n=a.findIndex(a=>Object.keys(e).find(t=>e[t]===a)===t);return-1===n||n===a.length-1?[]:a.slice(n+1).map(t=>Object.keys(e).find(a=>e[a]===t))},validateCandidate:t=>{var n,r,i,s;const o=[];(null==(n=t.name)?void 0:n.trim())||o.push("Name is required"),(null==(r=t.phone)?void 0:r.trim())||o.push("Phone number is required"),(null==(i=t.email)?void 0:i.trim())?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.email)||o.push("Invalid email format"):o.push("Email is required"),(null==(s=t.interestedFor)?void 0:s.trim())||o.push("Position of interest is required");const l=t.currentStage||a.determineCurrentStage(t),d=e[l];return d&&d.requiredFields.forEach(e=>{const n=a.getNestedValue(t,e);(!n||Array.isArray(n)&&0===n.length)&&o.push(`${e} is required for ${d.name} stage`)}),{isValid:0===o.length,errors:o}},getNestedValue:(e,t)=>t.split(".").reduce((e,t)=>{var a;if(t.includes("[")&&t.includes("]")){const[n,r]=t.split("["),i=parseInt(r.replace("]",""));return null==(a=null==e?void 0:e[n])?void 0:a[i]}return null==e?void 0:e[t]},e),setNestedValue:(e,t,a)=>{const n=t.split("."),r=n.pop(),i=n.reduce((e,t)=>{if(t.includes("[")&&t.includes("]")){const[a,n]=t.split("["),r=parseInt(n.replace("]",""));return e[a]||(e[a]=[]),e[a][r]||(e[a][r]={}),e[a][r]}return e[t]||(e[t]={}),e[t]},e);if(r.includes("[")&&r.includes("]")){const[e,t]=r.split("["),n=parseInt(t.replace("]",""));i[e]||(i[e]=[]),i[e][n]=a}else i[r]=a},formatCandidateForDisplay:e=>{const t=a.getStageConfig(e.currentStage),n=a.getStatusConfig(e.overallStatus);return{...e,displayName:e.name,displayPhone:a.formatPhoneNumber(e.phone),displayStage:t.name,displayStatus:n.name,stageColor:t.color,statusColor:n.color,experienceYears:a.parseExperience(e.totalExperience),salaryRange:`${e.lastSalary} â†’ ${e.salaryExpectation}`,daysInCurrentStage:a.calculateDaysInStage(e)}},formatPhoneNumber:e=>{if(!e)return"";const t=e.replace(/\D/g,"");return 10===t.length?`${t.slice(0,3)}-${t.slice(3,6)}-${t.slice(6)}`:e},parseExperience:e=>{if(!e)return 0;const t=e.match(/(\d+)/);return t?parseInt(t[1]):0},calculateDaysInStage:e=>{const t=new Date;let a=e.createdAt;switch(e.currentStage){case"resume-sharing":a=e.resumeSharing.date||e.createdAt;break;case"shortlisting":a=e.shortlisting.shortlistDate||e.createdAt;break;case"lineup-feedback":a=e.lineupFeedback.shortlistDate||e.createdAt;break;case"selection":a=e.selection.selectionDate||e.createdAt;break;case"closure":a=e.closure.joiningDate||e.createdAt}const n=Math.abs(t.getTime()-a.getTime());return Math.ceil(n/864e5)},createClientFeedback:(e,t,a,n)=>({feedbackNumber:e,clientName:t,feedback:a,scheduledDate:n,createdAt:new Date}),getCandidateProgress:t=>{const n=a.getStageConfig(t.currentStage),r=Object.keys(e).length;return Math.round(n.order/r*100)},createChangeHistoryEntry:(e,t,a,n,r,i)=>({id:`change_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,candidateId:e,changedBy:t,changedByName:a,changeType:n,changes:r,timestamp:new Date,reason:i}),trackFieldChanges:(e,t)=>{const n=[];Object.entries({name:"Name",phone:"Phone Number",email:"Email",location:"Location",interestedFor:"Position of Interest",currentCompany:"Current Company",designation:"Designation",totalExperience:"Total Experience",lastSalary:"Last Salary",salaryExpectation:"Salary Expectation",qualification:"Qualification",allocation:"Allocation",currentStage:"Current Stage",overallStatus:"Overall Status",rating:"Rating"}).forEach(([r,i])=>{const s=a.getNestedValue(e,r),o=a.getNestedValue(t,r);s!==o&&n.push({field:r,fieldDisplayName:i,oldValue:s,newValue:o,changeDescription:`${i} changed from "${s||"empty"}" to "${o||"empty"}"`})});return Object.entries({"registration.registrationStatus":"Registration Status","resumeSharing.resumeShareStatus":"Resume Share Status","shortlisting.shortlistStatus":"Shortlist Status","lineupFeedback.lineupStatus":"Lineup Status","selection.selectionStatus":"Selection Status","closure.joiningStatus":"Joining Status"}).forEach(([r,i])=>{const s=a.getNestedValue(e,r),o=a.getNestedValue(t,r);s!==o&&n.push({field:r,fieldDisplayName:i,oldValue:s,newValue:o,changeDescription:`${i} changed from "${s||"empty"}" to "${o||"empty"}"`})}),n},updateCandidateWithHistory:(e,t,n,r,i)=>{const s={...e},o=a.updateCandidateStage(e,t),l=a.trackFieldChanges(s,o);if(l.length>0){const t=a.createChangeHistoryEntry(e.id,n,r,"updated",l,i);o.changeHistory=[...e.changeHistory,t],o.lastModifiedBy=n,o.lastModifiedByName=r}return o},addNoteWithHistory:(e,t,n,r,i=!1)=>{const s={id:`note_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,content:t,createdBy:n,createdAt:new Date,isPrivate:i},o=a.createChangeHistoryEntry(e.id,n,r,"note_added",[{field:"notes",fieldDisplayName:"Notes",oldValue:null,newValue:t,changeDescription:`Added ${i?"private":"public"} note: "${t.substring(0,50)}${t.length>50?"...":""}"`}],"Note added");return{...e,notes:[...e.notes||[],s],changeHistory:[...e.changeHistory,o],lastModifiedBy:n,lastModifiedByName:r,updatedAt:new Date}},getFormattedChangeHistory:e=>e.changeHistory.sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime()).map(e=>({id:e.id,timestamp:e.timestamp,changedBy:e.changedBy,changedByName:e.changedByName,changeType:a.getChangeTypeDisplay(e.changeType),description:a.getChangeDescription(e),changes:e.changes,reason:e.reason})),getChangeTypeDisplay:e=>({created:"Created",updated:"Updated",status_changed:"Status Changed",stage_changed:"Stage Changed",note_added:"Note Added",document_uploaded:"Document Uploaded",interview_scheduled:"Interview Scheduled",merged:"Merged",imported:"Imported"}[e]||e),getChangeDescription:e=>{switch(e.changeType){case"created":return`Candidate created by ${e.changedByName}`;case"updated":return`${e.changes.length} field(s) updated by ${e.changedByName}`;case"status_changed":const t=e.changes.find(e=>"overallStatus"===e.field);return t?`Status changed from ${t.oldValue} to ${t.newValue} by ${e.changedByName}`:`Status updated by ${e.changedByName}`;case"stage_changed":const a=e.changes.find(e=>"currentStage"===e.field);return a?`Stage changed from ${a.oldValue} to ${a.newValue} by ${e.changedByName}`:`Stage updated by ${e.changedByName}`;case"note_added":return`Note added by ${e.changedByName}`;case"document_uploaded":return`Document uploaded by ${e.changedByName}`;case"interview_scheduled":return`Interview scheduled by ${e.changedByName}`;case"merged":return`Candidate merged by ${e.changedByName}`;case"imported":return`Candidate imported by ${e.changedByName}`;default:return`Action performed by ${e.changedByName}`}}};export{e as R,a as c};
