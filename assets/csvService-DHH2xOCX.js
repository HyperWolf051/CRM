import{j as e,C as t}from"./index-QKcSTkRp.js";import{r as a}from"./react-vendor-DD48japz.js";import{a as s}from"./router-vendor-CA0F1SnT.js";import{ab as r,z as n,a as l,N as i,O as o,X as c}from"./icons-vendor-CJrlQfS6.js";import{V as d,c as u}from"./csvMappings-CudA6gLI.js";function m({selectedItems:t=[],onBulkEdit:d,onBulkDelete:u,totalSelected:m=0,onClearSelection:p,className:h=""}){const g=s(),[x,f]=a.useState(!1),[b,j]=a.useState({allocation:"",overallStatus:"",currentStage:"",tags:""}),v=()=>{const e=window.location.pathname.includes("/app/recruiter");g(e?"/app/recruiter/csv-import":"/app/csv-import")},w=()=>{const e=window.location.pathname.includes("/app/recruiter");g(e?"/app/recruiter/csv-export":"/app/csv-export")};return 0===m?e.jsx("div",{className:`bg-white border border-gray-200 rounded-lg p-4 ${h}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Select items to perform bulk actions"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:v,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(r,{className:"w-4 h-4"}),e.jsx("span",{children:"Import CSV"})]}),e.jsxs("button",{onClick:w,className:"flex items-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(n,{className:"w-4 h-4"}),e.jsx("span",{children:"Export CSV"})]})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`bg-blue-50 border border-blue-200 rounded-lg p-4 ${h}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{className:"w-5 h-5 text-blue-600"}),e.jsxs("span",{className:"font-medium text-blue-900",children:[m," item",1!==m?"s":""," selected"]})]}),e.jsx("button",{onClick:p,className:"text-blue-600 hover:text-blue-800 transition-colors",children:"Clear selection"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center space-x-2 bg-white text-blue-600 border border-blue-300 px-3 py-2 rounded-lg hover:bg-blue-50 transition-colors",children:[e.jsx(i,{className:"w-4 h-4"}),e.jsx("span",{children:"Edit"})]}),e.jsxs("button",{onClick:w,className:"flex items-center space-x-2 bg-green-600 text-white px-3 py-2 rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(n,{className:"w-4 h-4"}),e.jsx("span",{children:"Export"})]}),e.jsxs("button",{onClick:async()=>{if(!u||0===t.length)return;if(window.confirm(`Are you sure you want to delete ${t.length} selected item${1!==t.length?"s":""}? This action cannot be undone.`))try{await u(t)}catch(e){alert("Bulk delete failed: "+e.message)}},className:"flex items-center space-x-2 bg-red-600 text-white px-3 py-2 rounded-lg hover:bg-red-700 transition-colors",children:[e.jsx(o,{className:"w-4 h-4"}),e.jsx("span",{children:"Delete"})]}),e.jsx("div",{className:"border-l border-blue-300 pl-2 ml-2",children:e.jsxs("button",{onClick:v,className:"flex items-center space-x-2 bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(r,{className:"w-4 h-4"}),e.jsx("span",{children:"Import"})]})})]})]})}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Bulk Edit ",m," Items"]}),e.jsx("button",{onClick:()=>f(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(c,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Allocation"}),e.jsx("input",{type:"text",value:b.allocation,onChange:e=>j(t=>({...t,allocation:e.target.value})),placeholder:"e.g., Sheet-1, Team Alpha",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:b.overallStatus,onChange:e=>j(t=>({...t,overallStatus:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select status..."}),e.jsx("option",{value:"new",children:"New"}),e.jsx("option",{value:"in-process",children:"In Process"}),e.jsx("option",{value:"shortlisted",children:"Shortlisted"}),e.jsx("option",{value:"interviewed",children:"Interviewed"}),e.jsx("option",{value:"selected",children:"Selected"}),e.jsx("option",{value:"placed",children:"Placed"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stage"}),e.jsxs("select",{value:b.currentStage,onChange:e=>j(t=>({...t,currentStage:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select stage..."}),e.jsx("option",{value:"registration",children:"Registration"}),e.jsx("option",{value:"resume-sharing",children:"Resume Sharing"}),e.jsx("option",{value:"shortlisting",children:"Shortlisting"}),e.jsx("option",{value:"lineup-feedback",children:"Lineup & Feedback"}),e.jsx("option",{value:"selection",children:"Selection"}),e.jsx("option",{value:"closure",children:"Closure"}),e.jsx("option",{value:"completed",children:"Completed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags"}),e.jsx("input",{type:"text",value:b.tags,onChange:e=>j(t=>({...t,tags:e.target.value})),placeholder:"tag1, tag2, tag3",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Separate tags with commas"})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:async()=>{if(!d||0===t.length)return;const e={};if(b.allocation&&(e.allocation=b.allocation),b.overallStatus&&(e.overallStatus=b.overallStatus),b.currentStage&&(e.currentStage=b.currentStage),b.tags&&(e.tags=b.tags.split(",").map(e=>e.trim())),0!==Object.keys(e).length)try{await d(t,e),f(!1),j({allocation:"",overallStatus:"",currentStage:"",tags:""})}catch(a){alert("Bulk edit failed: "+a.message)}else alert("Please select at least one field to update")},className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:["Update ",m," Items"]})]})]})})]})}class p{static async importCandidates(e,a,s="registration"){const r={successful:0,failed:0,errors:[],importedCandidates:[]};for(let l=0;l<e.length;l++){const a=e[l],i=a._rowIndex||l+2;try{const{_rowIndex:e,_originalRow:n,_hasErrors:o,...c}=a,d={...c,id:`candidate_${Date.now()}_${l}`,currentStage:this.determineStageFromImportType(s),overallStatus:this.determineStatusFromData(c),createdBy:"csv_import",createdByName:"CSV Import",createdAt:new Date,updatedAt:new Date,changeHistory:[{id:`change_${Date.now()}_${l}`,candidateId:`candidate_${Date.now()}_${l}`,changedBy:"csv_import",changedByName:"CSV Import",changeType:"imported",changes:[{field:"all",fieldDisplayName:"All Fields",oldValue:null,newValue:c,changeDescription:`Candidate imported from CSV (${s})`}],timestamp:new Date,reason:`CSV import - ${s} data`}]},u=this.validateCandidateData(d);if(!u.isValid){r.errors.push({row:i,message:u.errors.join(", "),data:c}),r.failed++;continue}const m=await t.create(d);m.success?(r.successful++,r.importedCandidates.push(m.data)):(r.errors.push({row:i,message:m.message||"Failed to create candidate",data:c}),r.failed++)}catch(n){r.errors.push({row:i,message:n.message||"Unknown error occurred",data:a}),r.failed++}}return r}static determineStageFromImportType(e){return{registration:"registration",resumeShare:"resume-sharing",shortlist:"shortlisting",lineupFeedback:"lineup-feedback",selection:"selection",closure:"closure"}[e]||"registration"}static determineStatusFromData(e){var t,a,s,r,n,l,i;if("Yes"===(null==(t=e.closure)?void 0:t.joiningStatus))return"placed";if("Selected"===(null==(a=e.selection)?void 0:a.selectionStatus))return"selected";if("Rejected"===(null==(s=e.selection)?void 0:s.selectionStatus))return"rejected";if((null==(n=null==(r=e.lineupFeedback)?void 0:r.feedbacks)?void 0:n.length)>0){const t=e.lineupFeedback.feedbacks[e.lineupFeedback.feedbacks.length-1];if("Selected"===t.feedback)return"interviewed";if("Rejected"===t.feedback)return"rejected"}return"Done"===(null==(l=e.shortlisting)?void 0:l.shortlistStatus)?"shortlisted":"Done"===(null==(i=e.resumeSharing)?void 0:i.resumeShareStatus)?"in-process":"new"}static validateCandidateData(e){const t=[];if(["name","email"].forEach(a=>{e[a]&&""!==e[a].toString().trim()||t.push(`${a} is required`)}),e.email&&!d.email.pattern.test(e.email)&&t.push("Invalid email format"),e.phone){const a=d.phone.validate(e.phone);!0!==a&&t.push(a)}return{isValid:0===t.length,errors:t}}static async exportCandidates(e,t){try{const{fields:a,filters:s,exportType:r}=t;let n=[...e];(s.dateRange.start||s.dateRange.end)&&(n=n.filter(e=>{const t=new Date(e.createdAt),a=s.dateRange.start?new Date(s.dateRange.start):null,r=s.dateRange.end?new Date(s.dateRange.end):null;return!(a&&t<a)&&!(r&&t>r)})),"all"!==s.statusFilter&&(n=n.filter(e=>e.overallStatus===s.statusFilter));return{success:!0,data:this.convertCandidatesToCSV(n,a,r),count:n.length}}catch(a){return{success:!1,message:a.message,data:null}}}static convertCandidatesToCSV(e,t,a){const s=t,r=e.map(e=>t.map(t=>{let a=this.getNestedFieldValue(e,t);if(a instanceof Date?a=a.toISOString().split("T")[0]:Array.isArray(a)?a=a.map(e=>"object"==typeof e?JSON.stringify(e):e).join("; "):"object"==typeof a&&null!==a&&(a=JSON.stringify(a)),null==a)return"";const s=String(a);return s.includes(",")||s.includes('"')||s.includes("\n")?`"${s.replace(/"/g,'""')}"`:s}));return[s.join(","),...r.map(e=>e.join(","))].join("\n")}static getNestedFieldValue(e,t){const a=t.split(".");let s=e;for(const r of a){if(null==s)return"";s=s[r]}return s}static async detectDuplicates(e,a=[]){const s=[];if(0===a.length)try{const e=await t.getAll();e.success&&(a=e.data)}catch(r){}return e.forEach((e,t)=>{const r=a.filter(t=>{if(e.email&&t.email&&e.email.toLowerCase()===t.email.toLowerCase())return!0;if(e.phone&&t.phone){const a=e.phone.replace(/\D/g,"");if(a===t.phone.replace(/\D/g,"")&&a.length>=10)return!0}if(e.name&&t.name){if(e.name.toLowerCase().trim()===t.name.toLowerCase().trim())return!0}return!1});r.length>0&&s.push({newCandidateIndex:t,newCandidate:e,matches:r.map(t=>({id:t.id,name:t.name,email:t.email,phone:t.phone,matchReason:this.getDuplicateMatchReason(e,t)}))})}),s}static getDuplicateMatchReason(e,t){const a=[];if(e.email&&t.email&&e.email.toLowerCase()===t.email.toLowerCase()&&a.push("Email match"),e.phone&&t.phone){const s=e.phone.replace(/\D/g,"");s===t.phone.replace(/\D/g,"")&&s.length>=10&&a.push("Phone match")}return e.name&&t.name&&e.name.toLowerCase().trim()===t.name.toLowerCase().trim()&&a.push("Name match"),a.join(", ")}static generateCSVTemplate(e){const t=u.CSV_FIELD_MAPPINGS[e];if(!t)throw new Error(`Unknown import type: ${e}`);const a=Object.keys(t),s=a.map(e=>{switch(e){case"DATE":return"4-08-2025";case"CV No":return"CV001";case"NAME":return"John Doe";case"PHONE":return"+91 9876543210";case"EMAIL":return"john.doe@email.com";case"LOC.(City,State)":return"Mumbai, Maharashtra";case"INTERSTED FOR":return"Software Developer";case"DESIGNATION":return"Senior Developer";case"TOTAL EXP IN YEARS":return"5 years";case"LAST SALARY":return"8K";case"SALARY EXP.":return"12K";case"QUALIFICATION":return"B.Tech";case"REGISTRATION":return"Yes";case"REG.AMT":return"1000";case"ALLOCATION":return"Sheet-1";default:return"Sample Data"}});return[a.join(","),s.join(",")].join("\n")}}export{m as B,p as C};
