import{j as e}from"./index-LnfGub8m.js";import{r as s}from"./react-vendor-DD48japz.js";import{d as a,u as t}from"./useDuplicateDetection-EPU-eirK.js";import{R as r,o as l,W as d,U as n,i,c,aB as o,aC as x,r as m,a as g,K as h}from"./icons-vendor-CEd8OCNO.js";import{a as u}from"./router-vendor-CA0F1SnT.js";import"./http-vendor-ei4kQ0Q2.js";import"./candidateUtils-CAE7rsIc.js";const p=({duplicateGroups:t=[],onResolveGroup:h,onIgnoreGroup:u,onRefresh:p,isLoading:j=!1})=>{const[b,v]=s.useState({status:"all",confidence:"all",dateRange:{start:"",end:""},recruiter:[],matchType:"all",minScore:0,maxScore:100}),[f,N]=s.useState(""),[y,w]=s.useState(new Set),[C,R]=s.useState(!1),[S,k]=s.useState("detectedAt"),[D,A]=s.useState("desc"),G=t.filter(e=>{if("all"!==b.status&&e.status!==b.status)return!1;if(f){const s=f.toLowerCase();if(!e.candidates.some(e=>{var a,t,r;return(null==(a=e.name)?void 0:a.toLowerCase().includes(s))||(null==(t=e.email)?void 0:t.toLowerCase().includes(s))||(null==(r=e.phone)?void 0:r.includes(f))}))return!1}return!(b.dateRange.start&&new Date(e.detectedAt)<new Date(b.dateRange.start))&&!(b.dateRange.end&&new Date(e.detectedAt)>new Date(b.dateRange.end))}).sort((e,s)=>{let a,t;switch(S){case"detectedAt":a=new Date(e.detectedAt),t=new Date(s.detectedAt);break;case"candidateCount":a=e.candidates.length,t=s.candidates.length;break;case"status":a=e.status,t=s.status;break;default:return 0}return"asc"===D?a>t?1:-1:a<t?1:-1}),I=s=>{switch(s){case"pending":return e.jsx(m,{className:"w-4 h-4 text-amber-600"});case"resolved":return e.jsx(g,{className:"w-4 h-4 text-green-600"});case"ignored":return e.jsx(x,{className:"w-4 h-4 text-gray-600"});default:return e.jsx(m,{className:"w-4 h-4 text-gray-600"})}},P=e=>{switch(e){case"pending":return"bg-amber-50 text-amber-700 border-amber-200";case"resolved":return"bg-green-50 text-green-700 border-green-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}};return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Duplicate Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage and resolve duplicate candidate groups"})]}),e.jsxs("button",{onClick:p,disabled:j,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors",children:[e.jsx(r,{className:"w-4 h-4 "+(j?"animate-spin":"")}),e.jsx("span",{children:"Refresh"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",value:f,onChange:e=>N(e.target.value),placeholder:"Search by name, email, or phone...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("button",{onClick:()=>R(!C),className:"flex items-center space-x-2 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(d,{className:"w-4 h-4"}),e.jsx("span",{children:"Filters"})]})]}),C&&e.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:b.status,onChange:e=>v(s=>({...s,status:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"resolved",children:"Resolved"}),e.jsx("option",{value:"ignored",children:"Ignored"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date From"}),e.jsx("input",{type:"date",value:b.dateRange.start,onChange:e=>v(s=>({...s,dateRange:{...s.dateRange,start:e.target.value}})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date To"}),e.jsx("input",{type:"date",value:b.dateRange.end,onChange:e=>v(s=>({...s,dateRange:{...s.dateRange,end:e.target.value}})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})})]}),y.size>0&&e.jsx("div",{className:"p-4 bg-blue-50 border-b border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-blue-900",children:[y.size," group",1!==y.size?"s":""," selected"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>(y.forEach(e=>{t.find(s=>s.id===e)&&u(e)}),void w(new Set)),className:"px-3 py-1 text-sm bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Ignore Selected"}),e.jsx("button",{onClick:()=>w(new Set),className:"px-3 py-1 text-sm text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Clear Selection"})]})]})}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 border-b border-gray-200 px-6 py-3",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("label",{className:"flex items-center",children:e.jsx("input",{type:"checkbox",checked:y.size===G.length&&G.length>0,onChange:()=>{y.size===G.length?w(new Set):w(new Set(G.map(e=>e.id)))},className:"text-blue-600"})}),e.jsxs("div",{className:"flex-1 grid grid-cols-12 gap-4 text-sm font-medium text-gray-700",children:[e.jsx("div",{className:"col-span-4",children:"Candidates"}),e.jsx("div",{className:"col-span-2",children:"Status"}),e.jsx("div",{className:"col-span-2",children:"Detected"}),e.jsx("div",{className:"col-span-2",children:"Added By"}),e.jsx("div",{className:"col-span-2",children:"Actions"})]})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:0===G.length?e.jsx("div",{className:"p-8 text-center text-gray-500",children:j?e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(r,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Loading duplicate groups..."})]}):e.jsxs("div",{children:[e.jsx(n,{className:"w-12 h-12 mx-auto text-gray-300 mb-4"}),e.jsx("p",{children:"No duplicate groups found"})]})}):G.map(s=>e.jsx("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("label",{className:"flex items-center mt-1",children:e.jsx("input",{type:"checkbox",checked:y.has(s.id),onChange:e=>((e,s)=>{const a=new Set(y);s?a.add(e):a.delete(e),w(a)})(s.id,e.target.checked),className:"text-blue-600"})}),e.jsxs("div",{className:"flex-1 grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-4",children:e.jsx("div",{className:"space-y-2",children:s.candidates.map((a,t)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx(i,{className:"w-4 h-4 text-gray-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",children:a.name}),e.jsx("div",{className:"text-sm text-gray-600 truncate",children:a.email})]}),0===t&&s.primaryCandidateId===a.id&&e.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full",children:"Primary"})]},a.id))})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("span",{className:`inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium border ${P(s.status)}`,children:[I(s.status),e.jsx("span",{className:"capitalize",children:s.status})]})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-600",children:[e.jsx(c,{className:"w-4 h-4"}),e.jsx("span",{children:a.formatTimeAgo(new Date(s.detectedAt))})]})}),e.jsx("div",{className:"col-span-2",children:e.jsx("div",{className:"text-sm text-gray-600",children:s.candidates.map(e=>e.createdByName).filter((e,s,a)=>a.indexOf(e)===s).join(", ")})}),e.jsxs("div",{className:"col-span-2",children:["pending"===s.status&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>h(s.id,{type:"merge",primaryCandidateId:s.candidates[0].id}),className:"flex items-center space-x-1 px-3 py-1 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(o,{className:"w-3 h-3"}),e.jsx("span",{children:"Merge"})]}),e.jsxs("button",{onClick:()=>u(s.id),className:"flex items-center space-x-1 px-3 py-1 text-gray-600 border border-gray-300 text-sm rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(x,{className:"w-3 h-3"}),e.jsx("span",{children:"Ignore"})]})]}),"resolved"===s.status&&s.resolution&&e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:["Resolved by ",s.resolution.resolvedByName]}),e.jsx("div",{className:"text-xs text-gray-500",children:a.formatTimeAgo(new Date(s.resolvedAt))})]}),"ignored"===s.status&&e.jsx("div",{className:"text-sm text-gray-500",children:"Ignored"})]})]})]})},s.id))})]}),G.length>0&&e.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:["Showing ",G.length," of ",t.length," duplicate groups"]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{children:["Pending: ",t.filter(e=>"pending"===e.status).length]}),e.jsxs("span",{children:["Resolved: ",t.filter(e=>"resolved"===e.status).length]}),e.jsxs("span",{children:["Ignored: ",t.filter(e=>"ignored"===e.status).length]})]})]})})]})},j=()=>{const a=u(),{duplicateGroups:l,isLoading:d,error:i,getDuplicateGroups:c,resolveDuplicateGroup:o,ignoreDuplicateGroup:x}=t(),[j,b]=s.useState({total:0,pending:0,resolved:0,ignored:0,highConfidence:0,mediumConfidence:0,lowConfidence:0});s.useEffect(()=>{v()},[]),s.useEffect(()=>{const e={total:l.length,pending:l.filter(e=>"pending"===e.status).length,resolved:l.filter(e=>"resolved"===e.status).length,ignored:l.filter(e=>"ignored"===e.status).length,highConfidence:0,mediumConfidence:0,lowConfidence:0};b(e)},[l]);const v=async()=>{try{await c()}catch(e){}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>a("/app/recruiter/candidates"),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(h,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Duplicate Management"}),e.jsx("p",{className:"text-gray-600",children:"Identify and resolve duplicate candidate records"})]})]})}),i&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(m,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-red-900",children:"Error"}),e.jsx("p",{className:"text-sm text-red-800 mt-1",children:i})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(n,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Groups"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:j.total})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-amber-100 rounded-lg",children:e.jsx(m,{className:"w-6 h-6 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Review"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:j.pending})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(g,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Resolved"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:j.resolved})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx(r,{className:"w-6 h-6 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Ignored"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:j.ignored})]})]})})]}),e.jsx(p,{duplicateGroups:l,onResolveGroup:async(e,s)=>{try{(await o(e,s)).success}catch(a){alert("Failed to resolve duplicate group. Please try again.")}},onIgnoreGroup:async e=>{try{(await x(e)).success}catch(s){alert("Failed to ignore duplicate group. Please try again.")}},onRefresh:()=>{v()},isLoading:d}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-3",children:"How Duplicate Detection Works"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 text-sm text-blue-800",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Detection Algorithms"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• Email matching (exact and fuzzy)"}),e.jsx("li",{children:"• Phone number normalization and comparison"}),e.jsx("li",{children:"• Name similarity using Jaro-Winkler algorithm"}),e.jsx("li",{children:"• Phonetic matching for name variations"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Confidence Levels"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"High (90%+):"})," Very likely duplicates"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Medium (75-89%):"})," Probable duplicates"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Low (60-74%):"})," Possible duplicates"]}),e.jsx("li",{children:"• All matches preserve original recruiter information"})]})]})]})]})]})};export{j as default};
